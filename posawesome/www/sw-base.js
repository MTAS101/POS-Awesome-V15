self.__WB_MANIFEST;
const n="posawesome-cache-v1";async function i(e){const s=await e.keys();if(s.length>1e3){const c=s.length-1e3;for(let t=0;t<c;t++)await e.delete(s[t])}}self.addEventListener("install",e=>{self.skipWaiting(),e.waitUntil((async()=>{const s=await caches.open(n),c=["/app/posapp","/assets/posawesome/posawesome.bundle.js","/assets/posawesome/offline/index.js","/assets/posawesome/libs/dexie.min.js","/manifest.json","/offline.html"];await Promise.all(c.map(async t=>{try{const a=await fetch(t);a&&a.ok&&await s.put(t,a.clone())}catch(a){console.warn("SW install failed to fetch",t,a)}})),await i(s)})())});self.addEventListener("activate",e=>{e.waitUntil((async()=>{const s=await caches.keys();await Promise.all(s.filter(t=>t!==n).map(t=>caches.delete(t)));const c=await caches.open(n);await i(c),await self.clients.claim()})())});self.addEventListener("fetch",e=>{if(e.request.method!=="GET")return;const s=new URL(e.request.url);if(!(s.protocol!=="http:"&&s.protocol!=="https:")&&!e.request.url.includes("socket.io")){if(e.request.mode==="navigate"){e.respondWith((async()=>{try{return await fetch(e.request)}catch{return await caches.match(e.request,{ignoreSearch:!0})||caches.match("/app/posapp")||caches.match("/offline.html")}})());return}e.respondWith((async()=>{try{const c=await caches.match(e.request);if(c)return c;const t=await fetch(e.request);if(t&&t.ok&&t.status===200)try{const a=t.clone(),o=await caches.open(n);await o.put(e.request,a),await i(o)}catch(a){console.warn("SW cache put failed",a)}return t}catch{try{return await caches.match(e.request)||Response.error()}catch{return Response.error()}}})())}});
